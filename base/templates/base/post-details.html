{% extends "main.html" %}

{% block content %}

<div class="container mt-4">
  <div class="row">

    <!-- LEFT SIDEBAR : Topics -->
    <div class="col-md-3 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Browse Topics</h5>
          <hr>

          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <a href="{% url 'room' %}" class="text-decoration-none">All</a>
            </li>

            {% for topic in topics %}
            <li class="list-group-item">
              <a href="{% url 'room' %}?q={{ topic.name }}" class="text-decoration-none">
                {{ topic.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6 mb-4">
      <div class="card shadow">
        <div class="card-body">

          <h3 class="card-title mb-3">
            {{ room.name }}
          </h3>

          <p class="text-muted mb-2">
            Topic: {{ room.topic.name }}
          </p>

          <p class="text-muted">
            <i class="bi bi-person-circle"></i>
            <strong>{{ room.host.username|capfirst }}</strong>
            Â· {{ room.created|timesince }} ago
          </p>

          <hr>

          <p class="card-text" style="font-size: 1.05rem;">
            {{ room.description }}
          </p>

          <hr>


          <div class="d-flex justify-content-between">
            <a href="{% url 'room' %}" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-reply"></i>
            </a>

            {% if user.is_authenticated and room.host == request.user %}
            <div>
              <a href="{% url 'update-room' room.id %}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-pencil-square"></i>
              </a>
              <a href="{% url 'delete-room' room.id %}" class="btn btn-outline-danger btn-sm">
                <i class="bi bi-trash"></i>
              </a>
            </div>
            {% endif %}
          </div>

          <div class="mt-5">
            {% for message in messages %}
            <p>@{{message.user.username}} {{message.created | timesince}}</p>
            <p>{{message}}</p>
            {% if request.user == room.host or request.user == message.user %}
            <a href="{% url 'delete-message' message.id %}" class="btn btn-outline-danger"><i
                class="bi bi-trash"></i></a>
            {% endif %}
            {% endfor %}
          </div>


        </div>
        <div class="mt-3 px-2">
          <form method="POST">
            {% csrf_token %}
            <div class="input-group">
              <input type="text" name="comment" class="form-control" placeholder="Comment here...">
              <button type="submit" class="btn btn-outline-primary px-3">
                <i class="fa-solid fa-paper-plane"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Participants
          </h5>
          <hr>
          {% regroup messages by user as grouped_messages %}
          {% for group in grouped_messages %}
          <p>@{{ group.grouper.username | capfirst }}</p>
          {% endfor %}

          <!-- {% if messages %}
            {% for message in messages %}
              <div class="mb-3">
                <strong>@{{ message.user.username|capfirst }}</strong>
                <p class="mb-1 text-muted small">
                  {{ message.body }}
                </p>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted small">
              No comments yet.
            </p>
          {% endif %} -->

        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}